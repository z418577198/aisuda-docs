<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">API编排 | 爱速搭</title><meta data-react-helmet="true" property="og:url" content="https://baidu.gitee.io//aisuda-docs/API对接/API编排"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="API编排 | 爱速搭"><meta data-react-helmet="true" name="description" content="API 编排功能可以通过组合的方式整合处理多个 API / 业务节点的数据，输出业务终端需要的数据结果"><meta data-react-helmet="true" property="og:description" content="API 编排功能可以通过组合的方式整合处理多个 API / 业务节点的数据，输出业务终端需要的数据结果"><link data-react-helmet="true" rel="shortcut icon" href="/aisuda-docs/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://baidu.gitee.io//aisuda-docs/API对接/API编排"><link data-react-helmet="true" rel="alternate" href="https://baidu.gitee.io//aisuda-docs/API对接/API编排" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://baidu.gitee.io//aisuda-docs/API对接/API编排" hreflang="x-default"><link rel="stylesheet" href="/aisuda-docs/assets/css/styles.990bdfab.css">
<link rel="preload" href="/aisuda-docs/assets/js/runtime~main.1232d506.js" as="script">
<link rel="preload" href="/aisuda-docs/assets/js/main.f5b67967.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aisuda-docs/"><img src="/aisuda-docs/img/logo.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/aisuda-docs/img/logo.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">爱速搭</b></a><a class="navbar__item navbar__link navbar__link--active" href="/aisuda-docs/">使用手册</a><a class="navbar__item navbar__link" href="/aisuda-docs/快速入门/使用流程">快速入门</a><a class="navbar__item navbar__link" href="/aisuda-docs/私有部署/私有部署安装">私有部署</a><a class="navbar__item navbar__link" href="/aisuda-docs/OpenAPI/介绍">API</a></div><div class="navbar__items navbar__items--right"><a href="https://aisuda.bce.baidu.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>爱速搭官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://baidu.gitee.io/amis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>amis 官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">产品描述</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">组织管理</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">数据模型</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">页面设计</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">API对接</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aisuda-docs/API对接/基础">基础</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aisuda-docs/API对接/本地开发调试">本地开发调试</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aisuda-docs/API对接/API中心">API中心</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/aisuda-docs/API对接/API编排">API编排</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">应用管理</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">对象存储</a></li><li class="menu__list-item"><a class="menu__link" href="/aisuda-docs/应用发布">应用发布</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">API编排</h1></header><p>API 编排功能可以通过组合的方式整合处理多个 API / 业务节点的数据，输出业务终端需要的数据结果</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api-编排入门"></a>API 编排入门<a class="hash-link" href="#api-编排入门" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="基础"></a>基础<a class="hash-link" href="#基础" title="Direct link to heading">#</a></h3><p>API 编排本质上是一种用可视化的方式来编写后端代码，它可以用于不复杂的接口聚合及增删改查场景。</p><p>API 编排是树形接口，它的执行顺序是从上至下执行，比如下图：</p><p><img alt="tree" src="/aisuda-docs/assets/images/flow-tree-acf3d01105cc3153a8c7c2267a544cab.png"></p><p>这个 API 编排首先运行「并行执行」节点，这里面的子节点会并行运行，接着是循环节点，可以对前面的输出结果进行循环处理，然后在这个循环里面有个分支判断，如果成功就运行「设置变量」的节点，最后再运行「发送邮件」节点，如果熟悉写代码，上面这个树等价于下面的代码：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 这个是为了处理并行执行</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  httpResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sendHTTPAction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  sqlResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runSQL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 对 http 返回结果进行二次处理</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> item </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> httpResult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 分支</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 设置变量</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;成功&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 发送邮件</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sendMail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>各个节点之间如何协作？方法是通过变量，比如发起一个 HTTP 接口，其中有个配置是「存入变量」</p><p><img alt="var" src="/aisuda-docs/assets/images/var-920cae976e439c93ec6c4a0c29c5abfa.png"></p><p>执行完后，下面的节点就能通过这个变量来获取到内容，比如后面接一个「设置变量」的节点，在这个节点中，可以通过 <code>{{}}</code> 来获取到，比如下面这个例子获取到前面 output 变量中的 name 值，然后又将它写入变量 res。</p><p><img alt="var-set" src="/aisuda-docs/assets/images/var-set-1ae4bedcf818511dfafa30844f18bc87.png"></p><p>当所有节点执行完后，output 变量的值就作为最终结果返回前端。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="创建和编辑"></a>创建和编辑<a class="hash-link" href="#创建和编辑" title="Direct link to heading">#</a></h3><p>在【API 中心】列表中点击【新增 API】，弹出面板选择【多接口聚合模式】，即可新增一个 API 编排</p><p><img alt="new" src="/aisuda-docs/assets/images/new-e15414ad259217350113ba40c1923186.png"></p><p>保存后在列表中点击【多接口聚合设计】，即可进行整个 API 编排的设计</p><p><img alt="merge" src="/aisuda-docs/assets/images/merge-3df4e859e2a4e5a6cf38abe82ae54e5d.png"></p><p>点击连线上的 + 号，可添加连线所在层级的平级节点，点击节点右侧的 + 号，可添加该节点的子节点
<img alt="add" src="/aisuda-docs/assets/images/add-a12534c4328c08ca0871730598960ba7.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="一个简单的例子"></a>一个简单的例子<a class="hash-link" href="#一个简单的例子" title="Direct link to heading">#</a></h3><p>本例子将实现一个从服务端获取文章列表并对日期进行格式化后返回到前端的 API 编排</p><p>添加一个 “发送 HTTP 请求” 类型的节点，在 “请求地址” 输入框中填写以下 url</p><p><code>https://3xsw4ap8wah59.cfc-execute.bj.baidubce.com/apiArrangeDemo/list</code></p><p><img alt="http" src="/aisuda-docs/assets/images/http-c2e53cbddbc7efaa701a469d57812d12.png"></p><p>点击工具栏中的 “调试接口” 按钮
<img alt="run" src="/aisuda-docs/assets/images/run-988c910c7cabd9db50c64f91e43f90d9.png"></p><p>在弹出框中点击右下角的 “发送请求” 按钮，等待请求执行完毕后，可以看到请求结果和运行日志</p><p><img alt="send" src="/aisuda-docs/assets/images/send-252d2107604938ec3d9b351fff741308.png"></p><p>可以看到当前返回的数据是包含 items 和 total 两个字段的 json 格式数据，items 列表单项中的 date 字段是以毫秒时间戳格式返回的日期</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;items&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;id&quot;: 1,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;title&quot;: &quot;标题0&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;subscribe&quot;: &quot;摘要0&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;date&quot;: 1622793580560</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;total&quot;: 200</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这里我们希望将 date 字段转换为能够友好展示的日期字符串</p><p>为 “发送 HTTP 请求” 节点添加一个平级 “循环” 类型的节点，并为 “循环” 节点添加一个 “日期格式化” 子节点</p><p>“循环” 节点配置如下，接口返回的数据会被统一放在全局的 output 对象中，通过 <code>output.xxx</code> 可以取到相关字段
<img alt="loop" src="/aisuda-docs/assets/images/loop-73b3bf862604b54af8a0d3e2409561ae.png"></p><p>“日期格式化” 节点配置如下，循环节点的行为是循环执行自身子节点的逻辑
<img alt="dateformat" src="/aisuda-docs/assets/images/dateformat-adbfd22ef0691ea688bac6599418cbd2.png"></p><p>点击发送请求，可以看到返回数据中的 date 被格式化成了 <code>YYYY-MM-DD HH:mm:ss</code> 格式</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;items&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;id&quot;: 1,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;title&quot;: &quot;标题0&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;subscribe&quot;: &quot;摘要0&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;date&quot;: &quot;2021-06-04 17:23:41&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;total&quot;: 200</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>调试完之后需要点右下角的 “确认” 按钮保存，编辑界面中的内容才会被保存到数据库中
关于如何在页面中使用 API 编排获取数据，请看下一节</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="在页面中使用-api-编排"></a>在页面中使用 API 编排<a class="hash-link" href="#在页面中使用-api-编排" title="Direct link to heading">#</a></h3><p>在页面中使用 API 编排的方式，和使用 API 中心 API 的方式完全相同，下面同样以一个简单的例子来说明</p><p>新建一个普通页面，在页面中拖入一个增删改查组件</p><p>勾选增删改查组件的数据拉取接口的 “来自 API 中心” 选项，在列表中选择之前创建的 API 编排（和单个接口 API 在同一个列表中）</p><p>配置字段映射，可以看到 API 编排处理返回的数据被正常展示在列表中</p><p><img alt="crud" src="/aisuda-docs/assets/images/crud-2d4948476e5dfa0e70a1087c1fac3273.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="调试接口"></a>调试接口<a class="hash-link" href="#调试接口" title="Direct link to heading">#</a></h3><p>点击顶部的「调试接口」按钮进入接口调试功能。</p><p><img alt="debug" src="/aisuda-docs/assets/images/debug-b2d483344b8358371228888e2ac8a38f.png"></p><p>在接口调试弹窗中，可以输入提交参数，然后点击「发送请求」进行测试，除了查看输出结果，最有用的功能是查看执行过程的记录，如下图所示：</p><p><img alt="debug-result" src="/aisuda-docs/assets/images/debug-result-dba53a59ab94c8f6f87b15478f680eee.png"></p><p>对于初始节点和有数据变更的节点，还能点击旁边的加号来查看当时的数据情况，这样就能知道每一步操作是否正确对数据进行了处理。</p><p><img alt="debug-state" src="/aisuda-docs/assets/images/debug-state-f42f6a5e0c2f78f2dd2a6d19eba6479e.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="查看配置源码"></a>查看配置源码<a class="hash-link" href="#查看配置源码" title="Direct link to heading">#</a></h3><p>点击顶部的「查看配置源码」可以看到最终生成的树形结构配置，这是 API 编排在实际运行是所使用的格式，这个功能主要是用于结果预期不一致时进行调试，可以将这个配置发给爱速搭的管理员协助分析。</p><p><img alt="config-source" src="/aisuda-docs/assets/images/config-source-d5ddaa786667e337a5080b01d989998d.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="生成的伪代码示例"></a>生成的伪代码示例<a class="hash-link" href="#生成的伪代码示例" title="Direct link to heading">#</a></h3><p>点击顶部的「生成的伪代码示例」可以生成伪代码示例。</p><p><img alt="pseudocode" src="/aisuda-docs/assets/images/pseudocode-d9bc6894ad46b077f31b73b54d055a87.png"></p><p>这个功能主要是给习惯看源码的研发，可以方便看出执行流程，不过需要注意的是爱速搭实际执行并不是使用这个生成的代码，因此这里仅供参考，输出的伪代码并不保证能运行。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="节点分类介绍"></a>节点分类介绍<a class="hash-link" href="#节点分类介绍" title="Direct link to heading">#</a></h2><p>接下来详细介绍各个节点的功能</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="数据接口"></a>数据接口<a class="hash-link" href="#数据接口" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="发送-http-请求"></a>发送 HTTP 请求<a class="hash-link" href="#发送-http-请求" title="Direct link to heading">#</a></h4><p>最基本的 HTTP 请求发送节点，使用方法同【单个接口 API】，具体见<a href="/aisuda-docs/API对接/API中心">API 中心</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="数据源-sql"></a>数据源 SQL<a class="hash-link" href="#数据源-sql" title="Direct link to heading">#</a></h4><p>在数据源上执行 SQL 操作。</p><p>在 SQL 语句里用 <code>{{}}</code> 包裹的部分可以执行 JS 语句，实现灵活的处理，比如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select * from blog where title = {{ input.title }}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>它的实现原理是最终转成 <code>select * from blog where title = ?</code>，然后将 <code>input.title</code> 的值作为后续参数填入，因此默认会进行变量转义，防止 sql 注入</p><p>如果数据是一维数组，使用如下写法</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select * from blog where title in ({{ input.titles}})</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果是二维数组，比如下面的 <code>input.blogs</code> 是 <code>[[&#x27;标题1&#x27;, &#x27;内容1&#x27;], [&#x27;标题2&#x27;, &#x27;内容2&#x27;]]</code>，使用如下写法</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">insert into blog values {{ input.blogs }}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果要实现有参数时才查询，可以用如下写法</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select * from blog where ( {{ !input.title }} OR title = {{ input.title }} )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这个语句在输入参数有 <code>title</code> 的时候，会变成</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select * from blog where (FALSE OR title = ?)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果输入参数里没有 <code>title</code>，则会变成下面的语句，可以看到前面的条件是 true，所以 or 里的条件不会生效。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">select * from blog where (TRUE OR title = ?)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="执行控制"></a>执行控制<a class="hash-link" href="#执行控制" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="分支"></a>分支<a class="hash-link" href="#分支" title="Direct link to heading">#</a></h4><p>相当于代码中的 <code>if</code> 语句。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="循环"></a>循环<a class="hash-link" href="#循环" title="Direct link to heading">#</a></h4><p>循环用于对数组进行遍历，它的每个子节点用于执行每次循环的中的语句。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="跳出循环"></a>跳出循环<a class="hash-link" href="#跳出循环" title="Direct link to heading">#</a></h4><p>用于跳出循环，不再执行循环的后续所有操作，相当于代码中的 <code>break</code> 语句。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="继续循环"></a>继续循环<a class="hash-link" href="#继续循环" title="Direct link to heading">#</a></h4><p>用于跳过当前循环的后续操作，进入下一个循环，相当于代码中的 <code>continue</code> 语句。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="退出"></a>退出<a class="hash-link" href="#退出" title="Direct link to heading">#</a></h4><p>用于退出整个接口，后续不再执行任何操作</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="并行串行"></a>并行/串行<a class="hash-link" href="#并行串行" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="顺序执行"></a>顺序执行<a class="hash-link" href="#顺序执行" title="Direct link to heading">#</a></h4><p>按顺序执行子节点</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="并行执行"></a>并行执行<a class="hash-link" href="#并行执行" title="Direct link to heading">#</a></h4><p>这个节点下的子节点会并行执行，用于独立获取各种数据的场景。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="数据处理"></a>数据处理<a class="hash-link" href="#数据处理" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="设置变量"></a>设置变量<a class="hash-link" href="#设置变量" title="Direct link to heading">#</a></h4><p>赋值语句，用于对变量进行赋值。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="日期格式化"></a>日期格式化<a class="hash-link" href="#日期格式化" title="Direct link to heading">#</a></h4><p>对日期格式进行转换，比如将时间戳转成可读的日期格式。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="js-代码"></a>JS 代码<a class="hash-link" href="#js-代码" title="Direct link to heading">#</a></h4><p>通过 js 代码的方式来对数据进行处理，用于处理一些比较复杂的数据转换场景。</p><p>最简单的示例如下</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>其中 state 是 api 编排中的全局数据，比如前面如果有个 HTTP 节点将返回结果「存入变量」到 data 下，在 JS 代码中就能通过 <code>state.data</code> 获取到这个值，然后进行二次转换。</p><p>同时还能写入 <code>state.output</code> 来影响 api 聚合最终的输出结果。</p><p>这段 JS 函数的返回值会替换全局数据，因此上面的例子中直接返回 <code>state</code>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="其他"></a>其他<a class="hash-link" href="#其他" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="发送邮件"></a>发送邮件<a class="hash-link" href="#发送邮件" title="Direct link to heading">#</a></h4><p>用于发送邮件，比如进行邮件通知</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="session"></a>session<a class="hash-link" href="#session" title="Direct link to heading">#</a></h4><p>有一个特殊的全局变量 session，它会在整个用户会话中存储，如果写入这个变量，下次再次请求的时候还能读取到。</p><p>这个变量的值可以是字符串，也可以是对象，但整体大小限制在 2k 字节。</p><p>session 是应用级别隔离，不同应用在不同环境下是独立的。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/aisuda/aisuda-docs/edit/main/docs/API对接/API编排.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/aisuda-docs/API对接/API中心"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« API中心</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/aisuda-docs/应用管理/应用设置"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">应用设置 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#api-编排入门" class="table-of-contents__link">API 编排入门</a><ul><li><a href="#基础" class="table-of-contents__link">基础</a></li><li><a href="#创建和编辑" class="table-of-contents__link">创建和编辑</a></li><li><a href="#一个简单的例子" class="table-of-contents__link">一个简单的例子</a></li><li><a href="#在页面中使用-api-编排" class="table-of-contents__link">在页面中使用 API 编排</a></li><li><a href="#调试接口" class="table-of-contents__link">调试接口</a></li><li><a href="#查看配置源码" class="table-of-contents__link">查看配置源码</a></li><li><a href="#生成的伪代码示例" class="table-of-contents__link">生成的伪代码示例</a></li></ul></li><li><a href="#节点分类介绍" class="table-of-contents__link">节点分类介绍</a><ul><li><a href="#数据接口" class="table-of-contents__link">数据接口</a></li><li><a href="#执行控制" class="table-of-contents__link">执行控制</a></li><li><a href="#并行串行" class="table-of-contents__link">并行/串行</a></li><li><a href="#数据处理" class="table-of-contents__link">数据处理</a></li><li><a href="#其他" class="table-of-contents__link">其他</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/aisuda-docs/assets/js/runtime~main.1232d506.js"></script>
<script src="/aisuda-docs/assets/js/main.f5b67967.js"></script>
</body>
</html>